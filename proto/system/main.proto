// Editions version of proto3 file
edition = "2023";
package io.clbs.openhes.models.system;

option go_package = "github.com/cybroslabs/ouro-api-shared/gen/go/system";

import "common/fields.proto";
import "common/objects.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

// Defines the application-wide configuration containing settings for all system components.
// This model stores the actual configuration values that control system behavior.
message ApplicationConfig {
    repeated ComponentConfig items = 2;  // The configuration values for each registered component in the system.
}

// Defines the configuration for a single system component or microservice.
// Each component can define its own configuration fields through field descriptors.
message ComponentConfig {
    // The unique component name.
    // @example: "ouro-core-taskmaster"
    // @example: "ouro-core-dataproxy"
    // @example: "ouro-api"
    string name              = 1;
    common.FieldValues items = 2;  // The configuration values as field-value pairs. Fields are defined by the component's descriptors.
}

// Defines the configuration schema for a component, declaring what fields are available.
// Components register their configuration schema at startup to enable dynamic configuration.
message ComponentConfigDescriptor {
    string name                           = 1;  // The unique component name.
    repeated common.FieldDescriptor items = 2;  // The field descriptors defining available configuration options including types, defaults, and validation rules.
}

// Defines the complete application configuration schema and current values.
// This combines both the field definitions (descriptors) and the actual configuration values for all components.
message ApplicationConfigDescriptor {
    repeated ComponentConfigDescriptor descriptors = 1;  // The schema definitions for all registered components.
    repeated ComponentConfig items                 = 2;  // The current configuration values for all components.
}

// Defines the license information controlling system features, capacity, and validity.
// Licenses are validated against Cybroslabs licensing servers or installed manually for air-gapped deployments.
message License {
    string token                                 = 1;   // The JWT license token containing encoded license claims and signature.
    string id                                    = 2;   // The unique license identifier assigned by Cybroslabs.
    string name                                  = 3;   // The customer or organization name associated with this license.
    string description                           = 4;   // A human-readable description of the license type or tier (e.g., "Enterprise", "Trial").
    map<string, string> options                  = 5;   // Feature flags and capacity limits (e.g., "max_devices": "10000", "module_scada": "enabled").
    int32 version                                = 6;   // The license structure version for backwards compatibility handling.
    google.protobuf.Timestamp token_expiration   = 7;   // The JWT token expiration requiring renewal for air-gapped systems. This is when the token itself expires, not necessarily the license.
    google.protobuf.Timestamp license_expiration = 9;   // The actual license validity end date. Unset for perpetual licenses.
    google.protobuf.Timestamp service_expiration = 10;  // The support and updates entitlement end date. After this date, updates require license renewal.
}

// Defines the user profile containing identity and preferences for authenticated users.
// User profiles store both read-only attributes managed by the authentication system and user-controlled preferences.
message UserProfile {
    // The unique UUID of the user assigned by the authentication system (read-only).
    // @gqltype: UUID
    string id                = 1;
    // The user's full name or preferred display name shown in the UI.
    // @example: "John Doe"
    // @example: "Jane Smith"
    string display_name      = 2;
    // The authorization roles assigned to this user. Read-only, managed by the authentication system.
    // @example: ["admin", "operator"]
    // @example: ["viewer"]
    repeated string roles    = 3;
    // The user's preferred UI language using IETF language tags.
    // @example: "en-US"
    // @example: "cs-CZ"
    // @example: "de-DE"
    string ietf_language_tag = 4;
    // The user's timezone for displaying dates and times using IANA timezone names.
    // @example: "America/New_York"
    // @example: "Europe/Prague"
    // @example: "Asia/Tokyo"
    string timezone          = 5;
}

// Defines a request for setting or updating UI screen configuration.
// Screen configurations store user-specific or system-wide UI layout and settings for different application screens.
message SetScreenConfigRequest {
    // The application or UI plugin identifier.
    // @example: "core"
    // @example: "scada-plugin"
    string application_id = 1;
    // The screen identifier within the application.
    // @example: "device-list"
    // @example: "dashboard"
    // @example: "bulk-overview"
    string screen_id      = 2;
    // The screen configuration settings in one of the supported formats.
    oneof settings {
        string json                = 3;  // Configuration as a JSON-encoded string. Useful for direct storage from frontend.
        google.protobuf.Struct raw = 4;  // Configuration as a structured protobuf Struct. Used for programmatic access.
    }
}

// Defines the selection criteria for retrieving a specific UI screen configuration.
message ScreenConfigSelector {
    string application_id = 1;  // The application or UI plugin identifier.
    string screen_id      = 2;  // The screen identifier within the application.
}

// Defines feature flags and capability indicators for system objects.
// These flags control what operations are available or enabled for specific objects.
enum ObjectFlags {
    OBJECT_FLAG_UNSPECIFIED = 0;  // Default/unspecified flag (no special behavior).
    OBJECT_FLAG_COMMUNICATION_UNIT_LOG = 1; // The communication unit has detailed logging enabled for diagnostics and troubleshooting.
}

// Defines the request message for retrieving object flags.
message ObjectFlagsRequest {
    // The object type.
    // @example: OBJECT_TYPE_DEVICE
    // @example: OBJECT_TYPE_COMMUNICATION_UNIT
    common.ObjectType object_type = 1;
    // The object ID.
    // @gqltype: UUID
    string object_id = 2;
}

// Defines the response message for retrieving object flags.
message ObjectFlagsResponse {
    repeated ObjectFlags flags = 4;  // The object flags.
}
