// Editions version of proto3 file
edition = "2023";
package io.clbs.openhes.services.svcourooperator;

option go_package = "github.com/cybroslabs/ouro-api-shared/gen/go/services/svcourooperator";

import "google/protobuf/empty.proto";
import "google/protobuf/wrappers.proto";
import "acquisition/internal.proto";
import "acquisition/main.proto";
import "system/main.proto";

// Defines a specification for the Ouro Operator service.
// The Ouro Operator manages the Kubernetes infrastructure for the Ouro platform, handling driver lifecycle, scaling, configuration, licensing, and system upgrades.
service OuroOperatorService {
    // Retrieves a complete list of all registered drivers. Returns driver metadata including versions, capabilities, connection templates, and action definitions.
    rpc ListDrivers(google.protobuf.Empty) returns (io.clbs.openhes.models.acquisition.ListOfDriver);
    // Creates or updates a driver template. This method allows administrators to define or modify driver configurations that determine how driver instances are deployed in the Kubernetes cluster.
    rpc SetDriver(io.clbs.openhes.models.acquisition.Driver) returns (google.protobuf.Empty);
    // Retrieves the template configuration of the specified driver including its deployment specifications, resource requirements, and connection templates.
    rpc GetDriver(google.protobuf.StringValue) returns (io.clbs.openhes.models.acquisition.Driver);

    // Sets the number of replicas (instances) for a specific driver type. This controls horizontal scaling of driver pods in the Kubernetes cluster to handle varying workloads.
    rpc SetDriverScale(io.clbs.openhes.models.acquisition.SetDriverScaleRequest) returns (google.protobuf.Empty);
    // Retrieves the current number of replicas for the specified driver type, indicating how many instances are currently deployed.
    rpc GetDriverScale(io.clbs.openhes.models.acquisition.GetDriverScaleRequest) returns (google.protobuf.UInt32Value);

    // Retrieves the current application configuration including all component-specific settings and their descriptors. Returns both the configuration values and their field definitions.
    rpc GetApplicationConfig(google.protobuf.Empty) returns (io.clbs.openhes.models.system.ApplicationConfigDescriptor);
    // Updates the application configuration. Only the fields provided in the request are modified; omitted fields retain their current values. This allows partial configuration updates without affecting other settings.
    rpc UpdateApplicationConfig(io.clbs.openhes.models.system.ApplicationConfig) returns (google.protobuf.Empty);
    // Synchronizes component-specific configuration with the system. Components should provide all their default values and known configuration keys (including null values). The method merges defaults with existing values and removes any settings not declared in the defaults. Returns the current effective configuration for the component.
    rpc SynchronizeComponentConfig(io.clbs.openhes.models.system.ComponentConfigDescriptor) returns (io.clbs.openhes.models.system.ComponentConfig);

    // Initiates a driver upgrade process. Starts a driver in upgrade mode as a Kubernetes job to perform schema migrations and data structure upgrades between driver versions. The upgrade job is coordinated by the DeviceRegistry and automatically terminates after completion.
    rpc StartUpgrade(io.clbs.openhes.models.acquisition.StartUpgradeRequest) returns (google.protobuf.Empty);

    // Retrieves the currently installed license information including expiration date, feature flags, and capacity limits.
    rpc GetLicense(google.protobuf.Empty) returns (io.clbs.openhes.models.system.License);
    // Retrieves the license request code for the system. This code is used to generate a license for air-gapped installations. Returns an empty string if a valid license is already installed.
    rpc GetLicenseRequestCode(google.protobuf.Empty) returns (google.protobuf.StringValue);
    // Installs a new license key. This method is intended for air-gapped installations where the license cannot be activated through online channels. The license key must be obtained from Cybroslabs using the license request code.
    rpc SetLicense(google.protobuf.StringValue) returns (google.protobuf.Empty);

    // @group: System
    // Retrieves the software bill of materials (SBOM) information in CycloneDX JSON format. This provides a comprehensive inventory of all software components and their dependencies used by the Ouro Operator service.
    rpc GetSbom(google.protobuf.Empty) returns (google.protobuf.StringValue);
}
