// Editions version of proto3 file
edition = "2023";
package io.clbs.openhes.services.svctaskmaster;
option go_package = "github.com/cybroslabs/ouro-api-shared/gen/go/services/svctaskmaster";

import "google/protobuf/empty.proto";
import "google/protobuf/wrappers.proto";
import "acquisition/main.proto";
import "acquisition/internal.proto";
import "acquisition/shared.proto";
import "common/fields.proto";
import "common/types.proto";
import "common/internal.proto";

// The Taskmaster service definition.
// This service orchestrates job execution across drivers and provides APIs for job management, driver coordination, and device data synchronization.
service TaskmasterService {
    // Queues jobs for execution by the Taskmaster. This method accepts a list of jobs with their configurations, priorities, and constraints, and returns the identifiers of the queued jobs.
    rpc QueueJobs(io.clbs.openhes.models.acquisition.QueueJobsRequest) returns (io.clbs.openhes.models.acquisition.QueueJobsResponse);
    // Cancels the specified jobs. This method attempts to cancel jobs that are queued or in progress, preventing further execution.
    rpc CancelJobs(io.clbs.openhes.models.common.ListOfUInt64) returns (google.protobuf.Empty);

    // @group: Drivers
    // Registers a driver instance with the Taskmaster. Called by drivers during initialization to report their capabilities including version, listening port, supported meter types, concurrency limits, memory requirements, connection attribute templates, and available job action templates.
    rpc SetDriver(io.clbs.openhes.models.acquisition.SetDriver) returns (google.protobuf.Empty);
    // @group: Drivers
    // Stores a cache entry for the driver. Drivers use this method to persist state information across restarts. The cache key must be unique within the driver type.
    rpc SetCache(io.clbs.openhes.models.acquisition.SetCacheRequest) returns (google.protobuf.Empty);
    // @group: Drivers
    // Retrieves a cache entry for the driver. Drivers use this method to restore previously persisted state information. The cache key must be unique within the driver type.
    rpc GetCache(google.protobuf.StringValue) returns (io.clbs.openhes.models.acquisition.GetCacheResponse);
    // @group: Drivers
    // Deletes a cache entry for the driver. The cache key must be unique within the driver type.
    rpc DeleteCache(google.protobuf.StringValue) returns (google.protobuf.Empty);
    // @group: Drivers
    // Sets the default configuration values for a driver type. This method also resets any cached configuration to ensure the new defaults are applied.
    rpc SetDriverConfigDefaults(io.clbs.openhes.models.acquisition.SetConfigDefaultsRequest) returns (google.protobuf.Empty);
    // @group: Drivers
    // Retrieves the configuration for a specific driver type. Returns the merged configuration including defaults and any overrides specific to the driver type.
    rpc GetDriverConfig(io.clbs.openhes.models.acquisition.GetDriverConfigRequest) returns (io.clbs.openhes.models.common.FieldValues);
    // @group: Drivers
    // Sets managed fields for entities. Drivers use this method to update dynamic field values that are managed automatically by the driver rather than user-defined.
    rpc SetManagedFields(io.clbs.openhes.models.common.SetManagedFieldsRequest) returns (google.protobuf.Empty);
    // @group: Drivers
    // Maps device-specific keys to cross-device identifiers. The key can be any unique physical identifier (e.g. system-title, MAC address, serial number) specific to the device type. If the key is not yet registered, a new mapping entry is created. Returns all cross-device identifiers that match the given keys.
    rpc GetMapDeviceKeyXId(io.clbs.openhes.models.common.ListOfDeviceKey) returns (io.clbs.openhes.models.common.MapDeviceKeyXId);
    // @group: Drivers
    // Adds log records to a communication unit. Drivers call this method to report communication events, errors, or other diagnostic information. Duplicate records are automatically ignored.
    rpc AddCommunicationUnitLogs(io.clbs.openhes.models.acquisition.AddCommunicationUnitLogsRequest) returns (google.protobuf.Empty);
    // @group: Drivers
    // Updates the list of unknown devices visible by a communication unit. This method allows drivers to report devices discovered during network scanning that are not yet registered in the system.
    rpc SetUnknownDevices(io.clbs.openhes.models.acquisition.SetUnknownDevicesRequest) returns (google.protobuf.Empty);
    // @group: Drivers
    // Retrieves devices that match the specified attributes. Drivers use this method to query devices based on criteria such as device type, attributes, or other properties.
    rpc ListDevicesByAttributes(io.clbs.openhes.models.acquisition.DeviceAttributeSelector) returns (io.clbs.openhes.models.acquisition.ListOfDevice);
    // @group: Drivers
    // Retrieves communication units that match the specified attributes. Drivers use this method to query communication units based on criteria such as type, attributes, or other properties.
    rpc ListCommunicationUnitsByAttributes(io.clbs.openhes.models.acquisition.CommunicationUnitAttributeSelector) returns (io.clbs.openhes.models.acquisition.ListOfCommunicationUnit);
    // @group: Drivers
    // Updates the network topology by setting the neighbors of a communication unit. The neighbors list can include both communication units and devices. Any previously registered neighbors not included in the request are removed from the topology.
    rpc SetNeightbours(io.clbs.openhes.models.acquisition.SetNeighboursRequest) returns (google.protobuf.Empty);
    // @group: Drivers
    // Sets the current communication unit for device(s). The device selector may match multiple devices, and all matching devices are updated. The communication unit selector identifies which communication unit to associate; if no matching communication unit is found, the request is silently ignored.
    rpc SetCurrentDeviceCommunicationUnit(io.clbs.openhes.models.acquisition.SetCurrentDeviceCommunicationUnitRequest) returns (google.protobuf.Empty);
    // @group: Firmware Images
    // Retrieves the metadata of the specified firmware image. Drivers use this method to obtain firmware information including version, size, checksum, and target device types before downloading the firmware blocks.
    rpc GetFirmwareImage(google.protobuf.StringValue) returns (io.clbs.openhes.models.acquisition.FirmwareImage);
    // @group: Firmware Images
    // Retrieves a specific block of firmware image data. Drivers use this method to download firmware in chunks during device firmware update operations. The block size and offset are specified in the request.
    rpc GetFirmwareImageBlock(io.clbs.openhes.models.acquisition.GetFirmwareImageBlockRequest) returns (io.clbs.openhes.models.acquisition.FirmwareImageBlock);

    // @group: System
    // Retrieves the software bill of materials (SBOM) information in CycloneDX JSON format. This provides a comprehensive inventory of all software components and their dependencies used by the Taskmaster service.
    rpc GetSbom(google.protobuf.Empty) returns (google.protobuf.StringValue);
}
