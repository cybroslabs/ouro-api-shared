// Editions version of proto3 file
edition = "2023";
package io.clbs.openhes.models.crypto;

option go_package = "github.com/cybroslabs/ouro-api-shared/gen/go/crypto";

import "google/protobuf/timestamp.proto";
import "common/objects.proto";

// Defines the supported decryption methods for cryptographic secret data.
// These methods are used to decrypt device authentication keys and other sensitive credentials.
enum SecretDataDecryptionMethod {
    SECRET_DATA_UNSPECIFIED = 0;  // Unspecified decryption method (invalid, should not be used).
    SECRET_DATA_PLAIN       = 1;  // Data is stored in plain text without encryption (not recommended for production).
    SECRET_DATA_AES256CBC   = 2;  // Data is encrypted using AES-256 in CBC mode. Requires an initialization vector.
}

// Defines the supported decryption methods for session keys used in key wrapping scenarios.
// Session keys provide an additional layer of security for protecting cryptographic secrets.
enum SecretSessionKeyDecryptionMethod {
    SECRET_SESSION_UNSPECIFIED    = 0;  // No session key is used. The secret data is encrypted directly with the master key.
    SECRET_SESSION_PLAIN          = 1;  // Session key is stored in plain text (used when the session key itself is not sensitive).
    SECRET_SESSION_RSA_OAEPM_GF1P = 2;  // Session key is encrypted using RSA-OAEP with MGF1 and SHA-1. Used for secure key transport.
}

// Defines a specification for retrieving crypto secrets.
message GetCryptoSecretRequest {
    // The resource type for which the secret is defined.
    // @example: OBJECT_TYPE_BULK
    // @example: OBJECT_TYPE_DEVICE
    common.ObjectType object_type = 1;
    // The driver type for which the secret is requested.
    // @example: "METERCONTROL_ST402D_DLMS"
    // @example: "LANDISGYR_E650_DLMS_SN"
    string driver_type            = 2;
    // The crypto identifier of the secret to retrieve.
    // @gqltype: UUID
    string crypto_id              = 3;
}

// Defines a list of crypto secrets.
message CryptoSecrets {
    repeated CryptoSecret secrets = 1;  // A list of crypto secrets.
}

// Defines a cryptographic secret containing sensitive credentials for device communication.
// Secrets include authentication keys, encryption keys, and passwords used to establish secure connections with devices.
message CryptoSecret {
    reserved 5, 6, 7, 8, 9, 10, 11, 12, 13, 14;
    // The security access level this secret relates to. Maps to DLMS/COSEM association levels or similar concepts in other protocols.
    // @example: "1"
    // @example: "2"
    // @example: "G"
    // @example: "cert"
    string access_level                  = 1;
    // The unique identifier for this secret value. Used to distinguish between multiple crypto secrets within the same device.
    // @example: "AK"
    // @example: "EK"
    // @example: "PW"
    // @example: "CERT"
    string key_id                        = 2;
    google.protobuf.Timestamp created_at = 3;   // The timestamp when this secret was initially created in the system.
    google.protobuf.Timestamp updated_at = 4;   // The timestamp when this secret was last modified or rotated.
    bytes data                           = 15;  // The actual secret data (e.g., encryption key, password). This field contains the decrypted value ready for use.
}

// Defines a specification for creating or updating crypto secrets.
message SetCryptoSecretRequest {
    reserved 11, 12, 13, 14;
    // The resource type for which the secret is defined.
    // @example: OBJECT_TYPE_BULK
    // @example: OBJECT_TYPE_DEVICE
    common.ObjectType object_type = 1;
    // The driver type for which the secret is created or updated.
    // @example: "METERCONTROL_ST402D_DLMS"
    // @example: "LANDISGYR_E650_DLMS_SN"
    string driver_type            = 2;
    // The crypto identifier of the secret to create or update.
    // @gqltype: UUID
    string crypto_id              = 3;
    // The security access level for this secret value. Maps to DLMS/COSEM association levels or similar concepts in other protocols.
    // @example: "1"
    // @example: "2"
    // @example: "G"
    // @example: "cert"
    string access_level           = 4;
    // The unique identifier for this secret value. Used to distinguish between multiple crypto secrets within the same device.
    // @example: "AK"
    // @example: "EK"
    // @example: "PW"
    // @example: "CERT"
    string key_id                 = 5;

    // The unique identifier for the key used to decrypt either the session key or the data directly.
    // @gqltype: UUID
    string decryption_secret_id                                    = 6;
    SecretSessionKeyDecryptionMethod session_key_decryption_method = 7;   // The method used to decrypt the session key. May be unset if the session key is not set or not used.
    bytes session_key                                              = 8;   // The session key (usually encrypted) used to decrypt the data.
    SecretDataDecryptionMethod data_decryption_method              = 9;   // The method used to decrypt the secret data. May be unset if the data is not encrypted.
    bytes data_decryption_iv                                       = 10;  // The initialization vector for the decryption method, if applicable.

    bytes data = 15;  // The secret data.
}
